pipeline { 
	agent {
			label 'maven'
		}
	tools {
    maven 'maven'
	}
	environment {
        ProjDir1 = 'lesson26/Hello Devops'
		ProjDir2 = 'lesson26/Hello Jenkins'
        ProjDir3 = 'lesson26/Hello World'
    }
    stages { 
        stage("Compile & Build Binary") { 
			parallel {
				stage('stage project-a') {
					stages {
						stage('Build') {
							steps {
								dir("${env.ProjDir1}") { 
									sh 'mvn -B -DskipTests clean package'
								}
							}
						}
						stage('Test') {
							steps {
								dir("${env.ProjDir1}") { 
									sh 'mvn test'
								}
							}
							post {
								always {
									junit 'target/surefire-reports/*.xml'
								}
							}
						}
						stage('Deliver') { 
							steps {
								sh './jenkins/scripts/deliver.sh' 
							}
						}
					}
				}
				stage('stage project-b') {
					stages {
						stage('Build') {
							steps {
								dir("${env.ProjDir2}") { 
									sh 'mvn -B -DskipTests clean package'
								}
							}
						}
						stage('Test') {
							steps {
								sh 'mvn test'
							}
							post {
								always {
									junit 'target/surefire-reports/*.xml'
								}
							}
						}
						stage('Deliver') { 
							steps {
								sh './jenkins/scripts/deliver.sh' 
							}
						}
					}
				}
				stage('stage project-c') {
					stages {
						stage('Build') {
							steps {
								dir("${env.ProjDir1}") { 
									sh 'mvn -B -DskipTests clean package'
								}
							}
						}
						stage('Test') {
							steps {
								sh 'mvn test'
							}
							post {
								always {
									junit 'target/surefire-reports/*.xml'
								}
							}
						}
						stage('Deliver') { 
							steps {
								sh './jenkins/scripts/deliver.sh' 
							}
						}
					}
				}
            } 
        } 
    } 
}